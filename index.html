<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>StreamHG Upload + Folder Create</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 1rem;
            line-height: 1.5;
            transition: background 0.3s, color 0.3s;
        }
        body.light {
            background: #f8f9fa;
            color: #333;
        }
        body.dark {
            background: #121212;
            color: #e0e0e0;
        }
        .container {
            max-width: 640px;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            transition: background 0.3s, box-shadow 0.3s;
        }
        body.light .container { background: white; }
        body.dark  .container { background: #1e1e1e; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }

        h1 { font-size: 1.6rem; text-align: center; margin-bottom: 1.5rem; }
        body.light h1 { color: #1a1a1a; }
        body.dark  h1 { color: #ffffff; }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .toggle {
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.2s;
        }
        body.light .toggle:hover { background: #e9ecef; }
        body.dark  .toggle:hover { background: #333; }

        .form-group { margin-bottom: 1.25rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem; }
        body.light label { color: #333; }
        body.dark  label { color: #ddd; }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border-radius: 8px;
            transition: all 0.2s;
        }
        body.light input, body.light textarea, body.light select {
            background: white;
            border: 1px solid #ced4da;
            color: #333;
        }
        body.dark input, body.dark textarea, body.dark select {
            background: #2d2d2d;
            border: 1px solid #444;
            color: #e0e0e0;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }

        .input-wrapper { position: relative; }
        .clear-btn {
            position: absolute;
            right: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 1.6rem;
            cursor: pointer;
            padding: 0.3rem;
            line-height: 1;
            display: none;
        }
        body.light .clear-btn { color: #6c757d; }
        body.dark  .clear-btn { color: #aaa; }
        .clear-btn:hover { color: #212529; }

        .buttons { display: flex; flex-wrap: wrap; gap: 0.75rem; margin: 1.5rem 0; }
        button {
            flex: 1 1 180px;
            padding: 0.9rem 1.2rem;
            font-size: 1.05rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #loadFoldersBtn, #createFolderBtn { background: #28a745; color: white; }
        #loadFoldersBtn:hover:not(:disabled), #createFolderBtn:hover:not(:disabled) { background: #218838; }
        #uploadBtn { background: #007bff; color: white; }
        #uploadBtn:hover:not(:disabled) { background: #0069d9; }
        button:disabled { background: #555 !important; cursor: not-allowed; color: #aaa; }

        #result {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 40vh;
            overflow-y: auto;
        }
        .success { background: #2e7d32; color: #d4edda; }
        .error   { background: #c62828; color: #ffcdd2; }
        .info    { background: #37474f; color: #e0e0e0; }

        body.light .success { background: #d4edda; color: #155724; }
        body.light .error   { background: #f8d7da; color: #721c24; }
        body.light .info    { background: #e2e3e5; color: #383d41; }

        small.note { display: block; margin-top: 0.4rem; font-size: 0.85rem; }
        body.light small.note { color: #6c757d; }
        body.dark  small.note { color: #aaa; }

        option.level-1 { padding-left: 1.2rem; }
        option.level-2 { padding-left: 2.4rem; }
        option.level-3 { padding-left: 3.6rem; }
        option.level-4 { padding-left: 4.8rem; }
        option.level-5 { padding-left: 6rem; }

        @media (max-width: 480px) {
            .container { padding: 1.2rem; }
            h1 { font-size: 1.4rem; }
            button { flex: 1 1 100%; }
            .buttons { flex-direction: column; }
        }
    </style>
</head>
<body class="light">

<div class="container">

    <div class="header">
        <h1>StreamHG Upload + Create Folder</h1>
        <span class="toggle" id="themeToggle">‚òÄÔ∏è</span>
    </div>

    <div class="form-group">
        <label for="apiKey">API Key</label>
        <input type="text" id="apiKey" placeholder="Your StreamHG API key" />
    </div>

    <div class="form-group">
        <label for="videoUrl">Video URL</label>
        <div class="input-wrapper">
            <input type="text" id="videoUrl" placeholder="https://example.com/video.mp4" />
            <button type="button" class="clear-btn" id="clearUrl">√ó</button>
        </div>
    </div>

    <div class="form-group">
        <label>Folder Management</label>
        <div class="buttons" style="margin: 0.5rem 0;">
            <button id="loadFoldersBtn">Load Folders</button>
            <button id="createFolderBtn">Create Folder</button>
        </div>
        <small class="note">Load first to see existing folders, or create directly in root.</small>
    </div>

    <div class="form-group" id="folderSelectGroup" style="display:none;">
        <label for="folderSelect">Select Parent / Target Folder</label>
        <select id="folderSelect">
            <option value="0">Root / Default (ID: 0)</option>
        </select>
    </div>

    <div class="form-group">
        <label for="newFolderName">New Folder Name</label>
        <input type="text" id="newFolderName" placeholder="e.g. My 2025 Videos" />
    </div>

    <div class="form-group">
        <label for="newFolderDesc">Description (optional)</label>
        <textarea id="newFolderDesc" placeholder="Short description of this folder"></textarea>
    </div>

    <div class="form-group">
        <label for="folderId">Upload Folder ID (auto-filled from selection)</label>
        <input type="text" id="folderId" value="0" placeholder="e.g. 25" />
        <small class="note">0 = root folder</small>
    </div>

    <div class="buttons">
        <button id="uploadBtn">Start Upload</button>
    </div>

    <div id="result"></div>

</div>

<script>
    // Theme toggle
    const toggle = document.getElementById('themeToggle');
    const body = document.body;

    function setTheme(isDark) {
        body.classList.toggle('dark', isDark);
        body.classList.toggle('light', !isDark);
        toggle.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    // Load saved theme or default to light
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        setTheme(true);
    } else {
        setTheme(false);
    }

    toggle.addEventListener('click', () => {
        setTheme(!body.classList.contains('dark'));
    });

    // Rest of your script (unchanged logic, just variables renamed for clarity)
    const apiKeyInput    = document.getElementById('apiKey');
    const urlInput       = document.getElementById('videoUrl');
    const clearBtn       = document.getElementById('clearUrl');
    const loadBtn        = document.getElementById('loadFoldersBtn');
    const createBtn      = document.getElementById('createFolderBtn');
    const folderSelect   = document.getElementById('folderSelect');
    const folderGroup    = document.getElementById('folderSelectGroup');
    const folderInput    = document.getElementById('folderId');
    const newNameInput   = document.getElementById('newFolderName');
    const newDescInput   = document.getElementById('newFolderDesc');
    const uploadBtn      = document.getElementById('uploadBtn');
    const result         = document.getElementById('result');

    const MAX_DEPTH = 5;

    urlInput.addEventListener('input', () => {
        clearBtn.style.display = urlInput.value.trim() ? 'block' : 'none';
    });

    clearBtn.addEventListener('click', () => {
        urlInput.value = '';
        clearBtn.style.display = 'none';
        urlInput.focus();
    });

    folderSelect.addEventListener('change', () => {
        folderInput.value = folderSelect.value;
    });

    folderInput.addEventListener('input', () => {
        const val = folderInput.value.trim();
        if (/^\d+$/.test(val) && folderSelect.querySelector(`option[value="${val}"]`)) {
            folderSelect.value = val;
        } else {
            folderSelect.value = '0';
        }
    });

    async function fetchFolders(parentId = 0, depth = 0, prefix = '') {
        if (depth > MAX_DEPTH) return [];
        const key = apiKeyInput.value.trim();
        if (!key) return [];
        const params = new URLSearchParams({ key, fld_id: parentId, files: 0 });
        try {
            const res = await fetch(`https://streamhgapi.com/api/folder/list?${params}`);
            const data = await res.json();
            if (data.status !== 200 || data.msg !== "OK" || !data.result?.folders) return [];
            let all = [];
            for (const f of data.result.folders || []) {
                const name = f.name || 'Unnamed';
                const id = f.fld_id;
                const display = prefix + name + ` (ID: ${id})`;
                const opt = new Option(display, id);
                opt.className = `level-${depth + 1}`;
                all.push(opt);
                const subs = await fetchFolders(id, depth + 1, prefix + '‚Üí ');
                all.push(...subs);
            }
            return all;
        } catch {
            return [];
        }
    }

    loadBtn.addEventListener('click', async () => {
        const key = apiKeyInput.value.trim();
        if (!key) return show('Enter API key first', 'error');

        loadBtn.disabled = true;
        loadBtn.textContent = 'Loading...';
        show('Fetching folders...', 'info');

        try {
            folderSelect.innerHTML = '<option value="0">Root / Default (ID: 0)</option>';
            const subs = await fetchFolders(0, 0, '');
            subs.forEach(o => folderSelect.appendChild(o));
            folderGroup.style.display = 'block';
            show(`Loaded (${subs.length} subfolders).`, 'success');
        } catch (e) {
            show(`Error: ${e.message}`, 'error');
        } finally {
            loadBtn.disabled = false;
            loadBtn.textContent = 'Load Folders';
        }
    });

    createBtn.addEventListener('click', async () => {
        const key = apiKeyInput.value.trim();
        const name = newNameInput.value.trim();
        const desc = newDescInput.value.trim();
        const parentId = folderSelect.value || '0';

        if (!key) return show('API key required', 'error');
        if (!name) return show('Folder name is required', 'error');

        createBtn.disabled = true;
        createBtn.textContent = 'Creating...';
        show('Creating folder...', 'info');

        try {
            const params = new URLSearchParams({
                key,
                name: encodeURIComponent(name)
            });
            if (parentId !== '0') params.append('parent_id', parentId);
            if (desc) params.append('descr', encodeURIComponent(desc));

            const res = await fetch(`https://streamhgapi.com/api/folder/create?${params}`);
            const data = await res.json();

            if (data.status === 200 && data.msg === "OK" && data.result?.fld_id) {
                const newId = data.result.fld_id;
                const parentOpt = folderSelect.querySelector(`option[value="${parentId}"]`);
                const level = parentOpt ? parseInt(parentOpt.className.replace('level-', '')) || 0 : 0;
                const prefix = '‚Üí '.repeat(level);
                const display = prefix + name + ` (ID: ${newId})`;

                const newOpt = new Option(display, newId);
                newOpt.className = `level-${level + 1}`;

                folderSelect.appendChild(newOpt);
                folderSelect.value = newId;
                folderInput.value = newId;

                show(`Folder created!\nName: ${name}\nID: ${newId}\nParent: ${parentId}`, 'success');
                newNameInput.value = '';
                newDescInput.value = '';
            } else {
                show(`Create failed: ${data.msg || 'Unknown error'}\nStatus: ${data.status || '?'}\n\n${JSON.stringify(data, null, 2)}`, 'error');
            }
        } catch (e) {
            show(`Network error: ${e.message}`, 'error');
        } finally {
            createBtn.disabled = false;
            createBtn.textContent = 'Create Folder';
        }
    });

    uploadBtn.addEventListener('click', async () => {
        const key = apiKeyInput.value.trim();
        const url = urlInput.value.trim();
        const fid = folderInput.value.trim();

        if (!key) return show('API key required', 'error');
        if (!url) return show('Video URL required', 'error');
        if (!/^https?:\/\//.test(url)) return show('URL must start with http(s)://', 'error');
        if (!/^\d+$/.test(fid)) return show('Folder ID must be a number', 'error');

        uploadBtn.disabled = true;
        show('Uploading‚Ä¶', 'info');

        try {
            const p = new URLSearchParams({ key, url });
            if (fid !== '0') p.append('fld_id', fid);
            const res = await fetch(`https://streamhgapi.com/api/upload/url?${p}`);
            const data = await res.json();

            if (data.status === 200 && data.msg === "OK" && data.result?.filecode) {
                show(`Success!\nFilecode: ${data.result.filecode}\n\nLink: https://streamhg.com/${data.result.filecode}`, 'success');
            } else {
                show(`Error: ${data.msg || 'Unknown'} (status ${data.status || '?'})`, 'error');
            }
        } catch (e) {
            show(`Network error: ${e.message}`, 'error');
        } finally {
            uploadBtn.disabled = false;
        }
    });

    function show(text, type = 'info') {
        result.textContent = text;
        result.className = type;
    }

    if (urlInput.value.trim()) clearBtn.style.display = 'block';
</script>

</body>
</html>
